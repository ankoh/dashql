analyzer-snapshots:

  - name: trino_explain
    script:
      input: |-
        select
          *,
          regexp_extract(query_hash, '[0-9a-zA-Z]+\.([0-9a-zA-Z]+)\.[0-9a-zA-Z]+', 1) as query_hash_1,
          regexp_extract(query_hash, '[0-9a-zA-Z]+\.[0-9a-zA-Z]+\.([0-9a-zA-Z]+)', 1) as literals_hash,
          (query like 'EXPLAIN (SQL internal_spark,%') as is_explain,
          (query like '%select distinct count(*)%') as is_count_star
        from iceberg.some_events.some_queries
        where (tenant = 'a360/prod3/foo' or tenant = 'a360/prod/bar')
        and query_metrics like '%raw_sql%'
        and event_timestamp >= current_timestamp - interval '30' day
      catalog-id: 0
      errors: []
      table-refs:
        - type: name/unresolved
          statement-id: 0
          text: "iceberg.so..me_queries"
      expressions:
        - expression-idx: 0
          type: colref/unresolved
          statement-id: 0
          text: "query_hash"
        - expression-idx: 1
          type: colref/unresolved
          statement-id: 0
          text: "query_hash"
        - expression-idx: 2
          type: colref/unresolved
          statement-id: 0
          text: "query"
        - expression-idx: 3
          type: colref/unresolved
          statement-id: 0
          text: "query"
        - expression-idx: 4
          type: colref/unresolved
          statement-id: 0
          text: "tenant"
        - expression-idx: 5
          type: colref/unresolved
          statement-id: 0
          text: "tenant"
        - expression-idx: 6
          type: colref/unresolved
          statement-id: 0
          text: "query_metrics"
        - expression-idx: 7
          type: colref/unresolved
          statement-id: 0
          text: "event_timestamp"
        - expression-idx: 8
          type: function
          name: regexp_extract
          computation: 0
          statement-id: 0
          text: "regexp_ext..A-Z]+', 1)"
        - expression-idx: 9
          type: function
          name: regexp_extract
          computation: 1
          statement-id: 0
          text: "regexp_ext..-Z]+)', 1)"
        - expression-idx: 10
          type: function
          known-function: CURRENT_TIMESTAMP
          is-const: true
          statement-id: 0
          text: "current_timestamp"
        - expression-idx: 11
          type: literal/string
          is-const: true
          statement-id: 0
          text: "'[0-9a-zA-..9a-zA-Z]+'"
        - expression-idx: 12
          type: literal/integer
          is-const: true
          statement-id: 0
          text: "1"
        - expression-idx: 13
          type: literal/string
          is-const: true
          statement-id: 0
          text: "'[0-9a-zA-..a-zA-Z]+)'"
        - expression-idx: 14
          type: literal/integer
          is-const: true
          statement-id: 0
          text: "1"
        - expression-idx: 15
          type: literal/string
          is-const: true
          statement-id: 0
          text: "'EXPLAIN (..l_spark,%'"
        - expression-idx: 16
          type: literal/string
          is-const: true
          statement-id: 0
          text: "'%select d..count(*)%'"
        - expression-idx: 17
          type: literal/string
          is-const: true
          statement-id: 0
          text: "'a360/prod3/foo'"
        - expression-idx: 18
          type: literal/string
          is-const: true
          statement-id: 0
          text: "'a360/prod/bar'"
        - expression-idx: 19
          type: literal/string
          is-const: true
          statement-id: 0
          text: "'%raw_sql%'"
        - expression-idx: 20
          type: literal/string
          is-const: true
          statement-id: 0
          text: "'30'"
        - expression-idx: 21
          type: constcast/interval
          is-const: true
          statement-id: 0
          text: "interval '30' day"
        - expression-idx: 22
          type: binary
          op: MINUS
          arg-left: 10
          arg-right: 21
          is-const: true
          statement-id: 0
          text: "current_ti..l '30' day"
        - expression-idx: 23
          type: comparison
          op: EQUAL
          arg-left: 4
          arg-right: 17
          restriction-target: 4
          statement-id: 0
          text: "tenant = '..prod3/foo'"
        - expression-idx: 24
          type: comparison
          op: EQUAL
          arg-left: 5
          arg-right: 18
          restriction-target: 5
          statement-id: 0
          text: "tenant = '../prod/bar'"
        - expression-idx: 25
          type: comparison
          op: GREATER_EQUAL
          arg-left: 7
          arg-right: 22
          restriction-target: 7
          statement-id: 0
          text: "event_time..l '30' day"
      constants:
        - expression: 11
          text: "'[0-9a-zA-..9a-zA-Z]+'"
        - expression: 12
          text: "1"
        - expression: 13
          text: "'[0-9a-zA-..a-zA-Z]+)'"
        - expression: 14
          text: "1"
        - expression: 15
          text: "'EXPLAIN (..l_spark,%'"
        - expression: 16
          text: "'%select d..count(*)%'"
        - expression: 17
          text: "'a360/prod3/foo'"
        - expression: 18
          text: "'a360/prod/bar'"
        - expression: 19
          text: "'%raw_sql%'"
        - expression: 21
          text: "interval '30' day"
          snippet:
            signature-template: 716161563929057878
            signature-raw: 18138650483241059678
            text: interval '30' day
            ast:
              ast-nodes: 4
              ast-bytes: 96
              node:
                type: OBJECT_SQL_CONST_INTERVAL_CAST
                text: "interval '30' day"
                nodes:
                  - key: SQL_CONST_CAST_VALUE
                    type: LITERAL_STRING
                    text: "'30'"
                  - key: SQL_CONST_CAST_INTERVAL
                    type: OBJECT_SQL_INTERVAL_TYPE
                    text: "day"
                    nodes:
                      - key: SQL_INTERVAL_TYPE
                        type: ENUM_SQL_INTERVAL_TYPE
                        value: DAY
        - expression: 22
          text: "current_ti..l '30' day"
          snippet:
            signature-template: 14335000208411224916
            signature-raw: 14531844735497943305
            text: current_timestamp - interval '30' day
            ast:
              ast-nodes: 9
              ast-bytes: 216
              node:
                type: OBJECT_SQL_NARY_EXPRESSION
                text: "current_ti..l '30' day"
                nodes:
                  - key: SQL_EXPRESSION_OPERATOR
                    type: ENUM_SQL_EXPRESSION_OPERATOR
                    value: MINUS
                  - key: SQL_EXPRESSION_ARGS
                    type: ARRAY
                    text: "current_ti..l '30' day"
                    nodes:
                      - type: OBJECT_SQL_FUNCTION_EXPRESSION
                        text: "current_timestamp"
                        nodes:
                          - key: SQL_FUNCTION_NAME
                            type: ENUM_SQL_KNOWN_FUNCTION
                            value: CURRENT_TIMESTAMP
                      - type: OBJECT_SQL_CONST_INTERVAL_CAST
                        text: "interval '30' day"
                        nodes:
                          - key: SQL_CONST_CAST_VALUE
                            type: LITERAL_STRING
                            text: "'30'"
                          - key: SQL_CONST_CAST_INTERVAL
                            type: OBJECT_SQL_INTERVAL_TYPE
                            text: "day"
                            nodes:
                              - key: SQL_INTERVAL_TYPE
                                type: ENUM_SQL_INTERVAL_TYPE
                                value: DAY
      column-computations:
        - expression: 8
          snippet:
            signature-template: 5606800037095841550
            signature-raw: 3197809837303275225
            text: 'regexp_extract(query_hash, ''[0-9a-zA-Z]+\.([0-9a-zA-Z]+)\.[0-9a-zA-Z]+'', 1)'
            ast:
              ast-nodes: 12
              ast-bytes: 288
              node:
                type: OBJECT_SQL_FUNCTION_EXPRESSION
                text: "regexp_ext..A-Z]+', 1)"
                nodes:
                  - key: SQL_FUNCTION_NAME
                    type: ARRAY
                    text: "regexp_extract"
                    nodes:
                      - type: NAME
                        text: "regexp_extract"
                  - key: SQL_FUNCTION_ARGUMENTS
                    type: ARRAY
                    text: "query_hash..zA-Z]+', 1"
                    nodes:
                      - type: OBJECT_SQL_FUNCTION_ARG
                        text: "query_hash"
                        nodes:
                          - key: SQL_FUNCTION_ARG_VALUE
                            type: OBJECT_SQL_COLUMN_REF
                            text: "query_hash"
                            nodes:
                              - key: SQL_COLUMN_REF_PATH
                                type: ARRAY
                                text: "query_hash"
                                nodes:
                                  - type: NAME
                                    text: "query_hash"
                      - type: OBJECT_SQL_FUNCTION_ARG
                        text: "'[0-9a-zA-..9a-zA-Z]+'"
                        nodes:
                          - key: SQL_FUNCTION_ARG_VALUE
                            type: LITERAL_STRING
                            text: "'[0-9a-zA-..9a-zA-Z]+'"
                      - type: OBJECT_SQL_FUNCTION_ARG
                        text: "1"
                        nodes:
                          - key: SQL_FUNCTION_ARG_VALUE
                            type: LITERAL_INTEGER
                            text: "1"
        - expression: 9
          snippet:
            signature-template: 5606800037095841550
            signature-raw: 10739155601962827482
            text: 'regexp_extract(query_hash, ''[0-9a-zA-Z]+\.[0-9a-zA-Z]+\.([0-9a-zA-Z]+)'', 1)'
            ast:
              ast-nodes: 12
              ast-bytes: 288
              node:
                type: OBJECT_SQL_FUNCTION_EXPRESSION
                text: "regexp_ext..-Z]+)', 1)"
                nodes:
                  - key: SQL_FUNCTION_NAME
                    type: ARRAY
                    text: "regexp_extract"
                    nodes:
                      - type: NAME
                        text: "regexp_extract"
                  - key: SQL_FUNCTION_ARGUMENTS
                    type: ARRAY
                    text: "query_hash..A-Z]+)', 1"
                    nodes:
                      - type: OBJECT_SQL_FUNCTION_ARG
                        text: "query_hash"
                        nodes:
                          - key: SQL_FUNCTION_ARG_VALUE
                            type: OBJECT_SQL_COLUMN_REF
                            text: "query_hash"
                            nodes:
                              - key: SQL_COLUMN_REF_PATH
                                type: ARRAY
                                text: "query_hash"
                                nodes:
                                  - type: NAME
                                    text: "query_hash"
                      - type: OBJECT_SQL_FUNCTION_ARG
                        text: "'[0-9a-zA-..a-zA-Z]+)'"
                        nodes:
                          - key: SQL_FUNCTION_ARG_VALUE
                            type: LITERAL_STRING
                            text: "'[0-9a-zA-..a-zA-Z]+)'"
                      - type: OBJECT_SQL_FUNCTION_ARG
                        text: "1"
                        nodes:
                          - key: SQL_FUNCTION_ARG_VALUE
                            type: LITERAL_INTEGER
                            text: "1"
      column-filters:
        - expression: 23
          snippet:
            signature-template: 7878761948638532652
            signature-raw: 12915170941615982935
            text: tenant = 'a360/prod3/foo'
            ast:
              ast-nodes: 7
              ast-bytes: 168
              node:
                type: OBJECT_SQL_NARY_EXPRESSION
                text: "tenant = '..prod3/foo'"
                nodes:
                  - key: SQL_EXPRESSION_OPERATOR
                    type: ENUM_SQL_EXPRESSION_OPERATOR
                    value: EQUAL
                  - key: SQL_EXPRESSION_ARGS
                    type: ARRAY
                    text: "tenant = '..prod3/foo'"
                    nodes:
                      - type: OBJECT_SQL_COLUMN_REF
                        text: "tenant"
                        nodes:
                          - key: SQL_COLUMN_REF_PATH
                            type: ARRAY
                            text: "tenant"
                            nodes:
                              - type: NAME
                                text: "tenant"
                      - type: LITERAL_STRING
                        text: "'a360/prod3/foo'"
        - expression: 24
          snippet:
            signature-template: 7878761948638532652
            signature-raw: 13423462593048553321
            text: tenant = 'a360/prod/bar'
            ast:
              ast-nodes: 7
              ast-bytes: 168
              node:
                type: OBJECT_SQL_NARY_EXPRESSION
                text: "tenant = '../prod/bar'"
                nodes:
                  - key: SQL_EXPRESSION_OPERATOR
                    type: ENUM_SQL_EXPRESSION_OPERATOR
                    value: EQUAL
                  - key: SQL_EXPRESSION_ARGS
                    type: ARRAY
                    text: "tenant = '../prod/bar'"
                    nodes:
                      - type: OBJECT_SQL_COLUMN_REF
                        text: "tenant"
                        nodes:
                          - key: SQL_COLUMN_REF_PATH
                            type: ARRAY
                            text: "tenant"
                            nodes:
                              - type: NAME
                                text: "tenant"
                      - type: LITERAL_STRING
                        text: "'a360/prod/bar'"
        - expression: 25
          snippet:
            signature-template: 17608407916322461543
            signature-raw: 17046291626474264120
            text: event_timestamp >= current_timestamp - interval '30' day
            ast:
              ast-nodes: 15
              ast-bytes: 360
              node:
                type: OBJECT_SQL_NARY_EXPRESSION
                text: "event_time..l '30' day"
                nodes:
                  - key: SQL_EXPRESSION_OPERATOR
                    type: ENUM_SQL_EXPRESSION_OPERATOR
                    value: GREATER_EQUAL
                  - key: SQL_EXPRESSION_ARGS
                    type: ARRAY
                    text: "event_time..l '30' day"
                    nodes:
                      - type: OBJECT_SQL_COLUMN_REF
                        text: "event_timestamp"
                        nodes:
                          - key: SQL_COLUMN_REF_PATH
                            type: ARRAY
                            text: "event_timestamp"
                            nodes:
                              - type: NAME
                                text: "event_timestamp"
                      - type: OBJECT_SQL_NARY_EXPRESSION
                        text: "current_ti..l '30' day"
                        nodes:
                          - key: SQL_EXPRESSION_OPERATOR
                            type: ENUM_SQL_EXPRESSION_OPERATOR
                            value: MINUS
                          - key: SQL_EXPRESSION_ARGS
                            type: ARRAY
                            text: "current_ti..l '30' day"
                            nodes:
                              - type: OBJECT_SQL_FUNCTION_EXPRESSION
                                text: "current_timestamp"
                                nodes:
                                  - key: SQL_FUNCTION_NAME
                                    type: ENUM_SQL_KNOWN_FUNCTION
                                    value: CURRENT_TIMESTAMP
                              - type: OBJECT_SQL_CONST_INTERVAL_CAST
                                text: "interval '30' day"
                                nodes:
                                  - key: SQL_CONST_CAST_VALUE
                                    type: LITERAL_STRING
                                    text: "'30'"
                                  - key: SQL_CONST_CAST_INTERVAL
                                    type: OBJECT_SQL_INTERVAL_TYPE
                                    text: "day"
                                    nodes:
                                      - key: SQL_INTERVAL_TYPE
                                        type: ENUM_SQL_INTERVAL_TYPE
                                        value: DAY

  - name: trino_inhibitors
    script:
      input: |-
        select 
          event_timestamp, elapsed, processed_rows_byol, workload_name,
          regexp_extract(pre_execution_query_metrics, '"federation-push-down-inhibitors":({.*}),"', 1) as inhibitors,
          query_plan
        from iceberg.some_events.some_queries
        where tenant = 'a360/prod/foo'
        and event_timestamp > cast ('2025-04-14' as timestamp)
        and processed_rows_byol > 0
        order by 3 desc
      catalog-id: 0
      errors: []
      table-refs:
        - type: name/unresolved
          statement-id: 0
          text: "iceberg.so..me_queries"
      expressions:
        - expression-idx: 0
          type: colref/unresolved
          statement-id: 0
          text: "event_timestamp"
        - expression-idx: 1
          type: colref/unresolved
          statement-id: 0
          text: "elapsed"
        - expression-idx: 2
          type: colref/unresolved
          statement-id: 0
          text: "processed_rows_byol"
        - expression-idx: 3
          type: colref/unresolved
          statement-id: 0
          text: "workload_name"
        - expression-idx: 4
          type: colref/unresolved
          statement-id: 0
          text: "pre_execut..ry_metrics"
        - expression-idx: 5
          type: colref/unresolved
          statement-id: 0
          text: "query_plan"
        - expression-idx: 6
          type: colref/unresolved
          statement-id: 0
          text: "tenant"
        - expression-idx: 7
          type: colref/unresolved
          statement-id: 0
          text: "event_timestamp"
        - expression-idx: 8
          type: colref/unresolved
          statement-id: 0
          text: "processed_rows_byol"
        - expression-idx: 9
          type: function
          name: regexp_extract
          computation: 4
          statement-id: 0
          text: "regexp_ext..*}),\"', 1)"
        - expression-idx: 10
          type: function
          known-function: CAST
          is-const: true
          statement-id: 0
          text: "cast ('202..timestamp)"
        - expression-idx: 11
          type: literal/string
          is-const: true
          statement-id: 0
          text: "'\"federati..:({.*}),\"'"
        - expression-idx: 12
          type: literal/integer
          is-const: true
          statement-id: 0
          text: "1"
        - expression-idx: 13
          type: literal/string
          is-const: true
          statement-id: 0
          text: "'a360/prod/foo'"
        - expression-idx: 14
          type: literal/string
          is-const: true
          statement-id: 0
          text: "'2025-04-14'"
        - expression-idx: 15
          type: literal/integer
          is-const: true
          statement-id: 0
          text: "0"
        - expression-idx: 16
          type: literal/integer
          is-const: true
          statement-id: 0
          text: "3"
        - expression-idx: 17
          type: comparison
          op: EQUAL
          arg-left: 6
          arg-right: 13
          restriction-target: 6
          statement-id: 0
          text: "tenant = '../prod/foo'"
        - expression-idx: 18
          type: comparison
          op: GREATER_THAN
          arg-left: 7
          arg-right: 10
          restriction-target: 7
          statement-id: 0
          text: "event_time..timestamp)"
        - expression-idx: 19
          type: comparison
          op: GREATER_THAN
          arg-left: 8
          arg-right: 15
          restriction-target: 8
          statement-id: 0
          text: "processed_..s_byol > 0"
      constants:
        - expression: 11
          text: "'\"federati..:({.*}),\"'"
        - expression: 12
          text: "1"
        - expression: 13
          text: "'a360/prod/foo'"
        - expression: 14
          text: "'2025-04-14'"
        - expression: 15
          text: "0"
        - expression: 16
          text: "3"
      column-computations:
        - expression: 9
          snippet:
            signature-template: 5606800037095841550
            signature-raw: 1321516605521455402
            text: 'regexp_extract(pre_execution_query_metrics, ''"federation-push-down-inhibitors":({.*}),"'', 1)'
            ast:
              ast-nodes: 12
              ast-bytes: 288
              node:
                type: OBJECT_SQL_FUNCTION_EXPRESSION
                text: "regexp_ext..*}),\"', 1)"
                nodes:
                  - key: SQL_FUNCTION_NAME
                    type: ARRAY
                    text: "regexp_extract"
                    nodes:
                      - type: NAME
                        text: "regexp_extract"
                  - key: SQL_FUNCTION_ARGUMENTS
                    type: ARRAY
                    text: "pre_execut...*}),\"', 1"
                    nodes:
                      - type: OBJECT_SQL_FUNCTION_ARG
                        text: "pre_execut..ry_metrics"
                        nodes:
                          - key: SQL_FUNCTION_ARG_VALUE
                            type: OBJECT_SQL_COLUMN_REF
                            text: "pre_execut..ry_metrics"
                            nodes:
                              - key: SQL_COLUMN_REF_PATH
                                type: ARRAY
                                text: "pre_execut..ry_metrics"
                                nodes:
                                  - type: NAME
                                    text: "pre_execut..ry_metrics"
                      - type: OBJECT_SQL_FUNCTION_ARG
                        text: "'\"federati..:({.*}),\"'"
                        nodes:
                          - key: SQL_FUNCTION_ARG_VALUE
                            type: LITERAL_STRING
                            text: "'\"federati..:({.*}),\"'"
                      - type: OBJECT_SQL_FUNCTION_ARG
                        text: "1"
                        nodes:
                          - key: SQL_FUNCTION_ARG_VALUE
                            type: LITERAL_INTEGER
                            text: "1"
      column-filters:
        - expression: 17
          snippet:
            signature-template: 7878761948638532652
            signature-raw: 12730198808566288772
            text: tenant = 'a360/prod/foo'
            ast:
              ast-nodes: 7
              ast-bytes: 168
              node:
                type: OBJECT_SQL_NARY_EXPRESSION
                text: "tenant = '../prod/foo'"
                nodes:
                  - key: SQL_EXPRESSION_OPERATOR
                    type: ENUM_SQL_EXPRESSION_OPERATOR
                    value: EQUAL
                  - key: SQL_EXPRESSION_ARGS
                    type: ARRAY
                    text: "tenant = '../prod/foo'"
                    nodes:
                      - type: OBJECT_SQL_COLUMN_REF
                        text: "tenant"
                        nodes:
                          - key: SQL_COLUMN_REF_PATH
                            type: ARRAY
                            text: "tenant"
                            nodes:
                              - type: NAME
                                text: "tenant"
                      - type: LITERAL_STRING
                        text: "'a360/prod/foo'"
        - expression: 18
          snippet:
            signature-template: 6070048643124566821
            signature-raw: 15548435774935499767
            text: event_timestamp > cast ('2025-04-14' as timestamp)
            ast:
              ast-nodes: 12
              ast-bytes: 288
              node:
                type: OBJECT_SQL_NARY_EXPRESSION
                text: "event_time..timestamp)"
                nodes:
                  - key: SQL_EXPRESSION_OPERATOR
                    type: ENUM_SQL_EXPRESSION_OPERATOR
                    value: GREATER_THAN
                  - key: SQL_EXPRESSION_ARGS
                    type: ARRAY
                    text: "event_time..timestamp)"
                    nodes:
                      - type: OBJECT_SQL_COLUMN_REF
                        text: "event_timestamp"
                        nodes:
                          - key: SQL_COLUMN_REF_PATH
                            type: ARRAY
                            text: "event_timestamp"
                            nodes:
                              - type: NAME
                                text: "event_timestamp"
                      - type: OBJECT_SQL_FUNCTION_EXPRESSION
                        text: "cast ('202..timestamp)"
                        nodes:
                          - key: SQL_FUNCTION_NAME
                            type: ENUM_SQL_KNOWN_FUNCTION
                            value: CAST
                          - key: SQL_FUNCTION_CAST_ARGS
                            type: OBJECT_SQL_FUNCTION_CAST_ARGS
                            text: "('2025-04-..timestamp)"
                            nodes:
                              - key: SQL_FUNCTION_CAST_VALUE
                                type: LITERAL_STRING
                                text: "'2025-04-14'"
                              - key: SQL_FUNCTION_CAST_TYPE
                                type: OBJECT_SQL_TYPENAME
                                text: "timestamp"
                                nodes:
                                  - key: SQL_TYPENAME_TYPE
                                    type: OBJECT_SQL_TIMESTAMP_TYPE
                                    text: "timestamp"
                                    nodes: []
        - expression: 19
          snippet:
            signature-template: 2279910941344963753
            signature-raw: 5597646258326568496
            text: processed_rows_byol > 0
            ast:
              ast-nodes: 7
              ast-bytes: 168
              node:
                type: OBJECT_SQL_NARY_EXPRESSION
                text: "processed_..s_byol > 0"
                nodes:
                  - key: SQL_EXPRESSION_OPERATOR
                    type: ENUM_SQL_EXPRESSION_OPERATOR
                    value: GREATER_THAN
                  - key: SQL_EXPRESSION_ARGS
                    type: ARRAY
                    text: "processed_..s_byol > 0"
                    nodes:
                      - type: OBJECT_SQL_COLUMN_REF
                        text: "processed_rows_byol"
                        nodes:
                          - key: SQL_COLUMN_REF_PATH
                            type: ARRAY
                            text: "processed_rows_byol"
                            nodes:
                              - type: NAME
                                text: "processed_rows_byol"
                      - type: LITERAL_INTEGER
                        text: "0"
