parser-snapshots:

  - name: trino_explain
    input: |-
      select
        *,
        regexp_extract(query_hash, '[0-9a-zA-Z]+\.([0-9a-zA-Z]+)\.[0-9a-zA-Z]+', 1) as query_hash_1,
        regexp_extract(query_hash, '[0-9a-zA-Z]+\.[0-9a-zA-Z]+\.([0-9a-zA-Z]+)', 1) as literals_hash,
        (query like 'EXPLAIN (SQL internal_spark,%') as is_explain,
        (query like '%select distinct count(*)%') as is_count_star
      from iceberg.some_events.some_queries
      where (tenant = 'a360/prod3/foo' or tenant = 'a360/prod/bar')
      and query_metrics like '%raw_sql%'
      and event_timestamp >= current_timestamp - interval '30' day
    expected:
      statements:
        - type: SELECT
          ast-begin: 0
          ast-size: 98
          ast:
            type: OBJECT_SQL_SELECT
            text: "select\n  *..l '30' day"
            children:
              - key: SQL_SELECT_TARGETS
                type: ARRAY
                text: "*,\n  regex..count_star"
                children:
                  - type: OBJECT_SQL_RESULT_TARGET
                    text: "*"
                    children:
                      - key: SQL_RESULT_TARGET_STAR
                        type: BOOL
                        value: 1
                  - type: OBJECT_SQL_RESULT_TARGET
                    text: "regexp_ext..ery_hash_1"
                    children:
                      - key: SQL_RESULT_TARGET_VALUE
                        type: OBJECT_SQL_FUNCTION_EXPRESSION
                        text: "regexp_ext..A-Z]+', 1)"
                        children:
                          - key: SQL_FUNCTION_NAME
                            type: ARRAY
                            text: "regexp_extract"
                            children:
                              - type: NAME
                                text: "regexp_extract"
                          - key: SQL_FUNCTION_ARGUMENTS
                            type: ARRAY
                            text: "query_hash..zA-Z]+', 1"
                            children:
                              - type: OBJECT_SQL_FUNCTION_ARG
                                text: "query_hash"
                                children:
                                  - key: SQL_FUNCTION_ARG_VALUE
                                    type: OBJECT_SQL_COLUMN_REF
                                    text: "query_hash"
                                    children:
                                      - key: SQL_COLUMN_REF_PATH
                                        type: ARRAY
                                        text: "query_hash"
                                        children:
                                          - type: NAME
                                            text: "query_hash"
                              - type: OBJECT_SQL_FUNCTION_ARG
                                text: "'[0-9a-zA-..9a-zA-Z]+'"
                                children:
                                  - key: SQL_FUNCTION_ARG_VALUE
                                    type: LITERAL_STRING
                                    text: "'[0-9a-zA-..9a-zA-Z]+'"
                              - type: OBJECT_SQL_FUNCTION_ARG
                                text: "1"
                                children:
                                  - key: SQL_FUNCTION_ARG_VALUE
                                    type: LITERAL_INTEGER
                                    text: "1"
                      - key: SQL_RESULT_TARGET_NAME
                        type: NAME
                        text: "query_hash_1"
                  - type: OBJECT_SQL_RESULT_TARGET
                    text: "regexp_ext..erals_hash"
                    children:
                      - key: SQL_RESULT_TARGET_VALUE
                        type: OBJECT_SQL_FUNCTION_EXPRESSION
                        text: "regexp_ext..-Z]+)', 1)"
                        children:
                          - key: SQL_FUNCTION_NAME
                            type: ARRAY
                            text: "regexp_extract"
                            children:
                              - type: NAME
                                text: "regexp_extract"
                          - key: SQL_FUNCTION_ARGUMENTS
                            type: ARRAY
                            text: "query_hash..A-Z]+)', 1"
                            children:
                              - type: OBJECT_SQL_FUNCTION_ARG
                                text: "query_hash"
                                children:
                                  - key: SQL_FUNCTION_ARG_VALUE
                                    type: OBJECT_SQL_COLUMN_REF
                                    text: "query_hash"
                                    children:
                                      - key: SQL_COLUMN_REF_PATH
                                        type: ARRAY
                                        text: "query_hash"
                                        children:
                                          - type: NAME
                                            text: "query_hash"
                              - type: OBJECT_SQL_FUNCTION_ARG
                                text: "'[0-9a-zA-..a-zA-Z]+)'"
                                children:
                                  - key: SQL_FUNCTION_ARG_VALUE
                                    type: LITERAL_STRING
                                    text: "'[0-9a-zA-..a-zA-Z]+)'"
                              - type: OBJECT_SQL_FUNCTION_ARG
                                text: "1"
                                children:
                                  - key: SQL_FUNCTION_ARG_VALUE
                                    type: LITERAL_INTEGER
                                    text: "1"
                      - key: SQL_RESULT_TARGET_NAME
                        type: NAME
                        text: "literals_hash"
                  - type: OBJECT_SQL_RESULT_TARGET
                    text: "(query lik..is_explain"
                    children:
                      - key: SQL_RESULT_TARGET_VALUE
                        type: OBJECT_SQL_NARY_EXPRESSION
                        text: "query like..l_spark,%'"
                        children:
                          - key: SQL_EXPRESSION_OPERATOR
                            type: ENUM_SQL_EXPRESSION_OPERATOR
                            value: LIKE
                          - key: SQL_EXPRESSION_ARGS
                            type: ARRAY
                            text: "query like..l_spark,%'"
                            children:
                              - type: OBJECT_SQL_COLUMN_REF
                                text: "query"
                                children:
                                  - key: SQL_COLUMN_REF_PATH
                                    type: ARRAY
                                    text: "query"
                                    children:
                                      - type: NAME
                                        text: "query"
                              - type: LITERAL_STRING
                                text: "'EXPLAIN (..l_spark,%'"
                      - key: SQL_RESULT_TARGET_NAME
                        type: NAME
                        text: "is_explain"
                  - type: OBJECT_SQL_RESULT_TARGET
                    text: "(query lik..count_star"
                    children:
                      - key: SQL_RESULT_TARGET_VALUE
                        type: OBJECT_SQL_NARY_EXPRESSION
                        text: "query like..count(*)%'"
                        children:
                          - key: SQL_EXPRESSION_OPERATOR
                            type: ENUM_SQL_EXPRESSION_OPERATOR
                            value: LIKE
                          - key: SQL_EXPRESSION_ARGS
                            type: ARRAY
                            text: "query like..count(*)%'"
                            children:
                              - type: OBJECT_SQL_COLUMN_REF
                                text: "query"
                                children:
                                  - key: SQL_COLUMN_REF_PATH
                                    type: ARRAY
                                    text: "query"
                                    children:
                                      - type: NAME
                                        text: "query"
                              - type: LITERAL_STRING
                                text: "'%select d..count(*)%'"
                      - key: SQL_RESULT_TARGET_NAME
                        type: NAME
                        text: "is_count_star"
              - key: SQL_SELECT_FROM
                type: ARRAY
                text: "from icebe..me_queries"
                children:
                  - type: OBJECT_SQL_TABLEREF
                    text: "iceberg.so..me_queries"
                    children:
                      - key: SQL_TABLEREF_NAME
                        type: ARRAY
                        text: "iceberg.so..me_queries"
                        children:
                          - type: NAME
                            text: "iceberg"
                          - type: NAME
                            text: "some_events"
                          - type: NAME
                            text: "some_queries"
              - key: SQL_SELECT_WHERE
                type: OBJECT_SQL_NARY_EXPRESSION
                text: "(tenant = ..l '30' day"
                children:
                  - key: SQL_EXPRESSION_OPERATOR
                    type: ENUM_SQL_EXPRESSION_OPERATOR
                    value: AND
                  - key: SQL_EXPRESSION_ARGS
                    type: ARRAY
                    text: "(tenant = ..l '30' day"
                    children:
                      - type: OBJECT_SQL_NARY_EXPRESSION
                        text: "tenant = '../prod/bar'"
                        children:
                          - key: SQL_EXPRESSION_OPERATOR
                            type: ENUM_SQL_EXPRESSION_OPERATOR
                            value: OR
                          - key: SQL_EXPRESSION_ARGS
                            type: ARRAY
                            text: "tenant = '../prod/bar'"
                            children:
                              - type: OBJECT_SQL_NARY_EXPRESSION
                                text: "tenant = '..prod3/foo'"
                                children:
                                  - key: SQL_EXPRESSION_OPERATOR
                                    type: ENUM_SQL_EXPRESSION_OPERATOR
                                    value: EQUAL
                                  - key: SQL_EXPRESSION_ARGS
                                    type: ARRAY
                                    text: "tenant = '..prod3/foo'"
                                    children:
                                      - type: OBJECT_SQL_COLUMN_REF
                                        text: "tenant"
                                        children:
                                          - key: SQL_COLUMN_REF_PATH
                                            type: ARRAY
                                            text: "tenant"
                                            children:
                                              - type: NAME
                                                text: "tenant"
                                      - type: LITERAL_STRING
                                        text: "'a360/prod3/foo'"
                              - type: OBJECT_SQL_NARY_EXPRESSION
                                text: "tenant = '../prod/bar'"
                                children:
                                  - key: SQL_EXPRESSION_OPERATOR
                                    type: ENUM_SQL_EXPRESSION_OPERATOR
                                    value: EQUAL
                                  - key: SQL_EXPRESSION_ARGS
                                    type: ARRAY
                                    text: "tenant = '../prod/bar'"
                                    children:
                                      - type: OBJECT_SQL_COLUMN_REF
                                        text: "tenant"
                                        children:
                                          - key: SQL_COLUMN_REF_PATH
                                            type: ARRAY
                                            text: "tenant"
                                            children:
                                              - type: NAME
                                                text: "tenant"
                                      - type: LITERAL_STRING
                                        text: "'a360/prod/bar'"
                      - type: OBJECT_SQL_NARY_EXPRESSION
                        text: "query_metr..%raw_sql%'"
                        children:
                          - key: SQL_EXPRESSION_OPERATOR
                            type: ENUM_SQL_EXPRESSION_OPERATOR
                            value: LIKE
                          - key: SQL_EXPRESSION_ARGS
                            type: ARRAY
                            text: "query_metr..%raw_sql%'"
                            children:
                              - type: OBJECT_SQL_COLUMN_REF
                                text: "query_metrics"
                                children:
                                  - key: SQL_COLUMN_REF_PATH
                                    type: ARRAY
                                    text: "query_metrics"
                                    children:
                                      - type: NAME
                                        text: "query_metrics"
                              - type: LITERAL_STRING
                                text: "'%raw_sql%'"
                      - type: OBJECT_SQL_NARY_EXPRESSION
                        text: "event_time..l '30' day"
                        children:
                          - key: SQL_EXPRESSION_OPERATOR
                            type: ENUM_SQL_EXPRESSION_OPERATOR
                            value: GREATER_EQUAL
                          - key: SQL_EXPRESSION_ARGS
                            type: ARRAY
                            text: "event_time..l '30' day"
                            children:
                              - type: OBJECT_SQL_COLUMN_REF
                                text: "event_timestamp"
                                children:
                                  - key: SQL_COLUMN_REF_PATH
                                    type: ARRAY
                                    text: "event_timestamp"
                                    children:
                                      - type: NAME
                                        text: "event_timestamp"
                              - type: OBJECT_SQL_NARY_EXPRESSION
                                text: "current_ti..l '30' day"
                                children:
                                  - key: SQL_EXPRESSION_OPERATOR
                                    type: ENUM_SQL_EXPRESSION_OPERATOR
                                    value: MINUS
                                  - key: SQL_EXPRESSION_ARGS
                                    type: ARRAY
                                    text: "current_ti..l '30' day"
                                    children:
                                      - type: OBJECT_SQL_FUNCTION_EXPRESSION
                                        text: "current_timestamp"
                                        children:
                                          - key: SQL_FUNCTION_NAME
                                            type: ENUM_SQL_KNOWN_FUNCTION
                                            value: CURRENT_TIMESTAMP
                                      - type: OBJECT_SQL_CONST_INTERVAL_CAST
                                        text: "interval '30' day"
                                        children:
                                          - key: SQL_CONST_CAST_VALUE
                                            type: LITERAL_STRING
                                            text: "'30'"
                                          - key: SQL_CONST_CAST_INTERVAL
                                            type: OBJECT_SQL_INTERVAL_TYPE
                                            text: "day"
                                            children:
                                              - key: SQL_INTERVAL_TYPE
                                                type: ENUM_SQL_INTERVAL_TYPE
                                                value: DAY
      scanner-errors: []
      parser-errors: []
      line-breaks:
        - text: [6,7]
        - text: [11,12]
        - text: [106,107]
        - text: [202,203]
        - text: [264,265]
        - text: [325,326]
        - text: [363,364]
        - text: [425,426]
        - text: [460,461]
      comments: []

  - name: trino_inhibitors
    input: |-
      select 
        event_timestamp, elapsed, processed_rows_byol, workload_name,
        regexp_extract(pre_execution_query_metrics, '"federation-push-down-inhibitors":({.*}),"', 1) as inhibitors,
        query_plan
      from iceberg.some_events.some_queries
      where tenant = 'a360/prod/foo'
      and event_timestamp > cast ('2025-04-14' as timestamp)
      and processed_rows_byol > 0
      order by 3 desc
    expected:
      statements:
        - type: SELECT
          ast-begin: 0
          ast-size: 75
          ast:
            type: OBJECT_SQL_SELECT
            text: "select \n  .. by 3 desc"
            children:
              - key: SQL_SELECT_TARGETS
                type: ARRAY
                text: "event_time..query_plan"
                children:
                  - type: OBJECT_SQL_RESULT_TARGET
                    text: "event_timestamp"
                    children:
                      - key: SQL_RESULT_TARGET_VALUE
                        type: OBJECT_SQL_COLUMN_REF
                        text: "event_timestamp"
                        children:
                          - key: SQL_COLUMN_REF_PATH
                            type: ARRAY
                            text: "event_timestamp"
                            children:
                              - type: NAME
                                text: "event_timestamp"
                  - type: OBJECT_SQL_RESULT_TARGET
                    text: "elapsed"
                    children:
                      - key: SQL_RESULT_TARGET_VALUE
                        type: OBJECT_SQL_COLUMN_REF
                        text: "elapsed"
                        children:
                          - key: SQL_COLUMN_REF_PATH
                            type: ARRAY
                            text: "elapsed"
                            children:
                              - type: NAME
                                text: "elapsed"
                  - type: OBJECT_SQL_RESULT_TARGET
                    text: "processed_rows_byol"
                    children:
                      - key: SQL_RESULT_TARGET_VALUE
                        type: OBJECT_SQL_COLUMN_REF
                        text: "processed_rows_byol"
                        children:
                          - key: SQL_COLUMN_REF_PATH
                            type: ARRAY
                            text: "processed_rows_byol"
                            children:
                              - type: NAME
                                text: "processed_rows_byol"
                  - type: OBJECT_SQL_RESULT_TARGET
                    text: "workload_name"
                    children:
                      - key: SQL_RESULT_TARGET_VALUE
                        type: OBJECT_SQL_COLUMN_REF
                        text: "workload_name"
                        children:
                          - key: SQL_COLUMN_REF_PATH
                            type: ARRAY
                            text: "workload_name"
                            children:
                              - type: NAME
                                text: "workload_name"
                  - type: OBJECT_SQL_RESULT_TARGET
                    text: "regexp_ext..inhibitors"
                    children:
                      - key: SQL_RESULT_TARGET_VALUE
                        type: OBJECT_SQL_FUNCTION_EXPRESSION
                        text: "regexp_ext..*}),\"', 1)"
                        children:
                          - key: SQL_FUNCTION_NAME
                            type: ARRAY
                            text: "regexp_extract"
                            children:
                              - type: NAME
                                text: "regexp_extract"
                          - key: SQL_FUNCTION_ARGUMENTS
                            type: ARRAY
                            text: "pre_execut...*}),\"', 1"
                            children:
                              - type: OBJECT_SQL_FUNCTION_ARG
                                text: "pre_execut..ry_metrics"
                                children:
                                  - key: SQL_FUNCTION_ARG_VALUE
                                    type: OBJECT_SQL_COLUMN_REF
                                    text: "pre_execut..ry_metrics"
                                    children:
                                      - key: SQL_COLUMN_REF_PATH
                                        type: ARRAY
                                        text: "pre_execut..ry_metrics"
                                        children:
                                          - type: NAME
                                            text: "pre_execut..ry_metrics"
                              - type: OBJECT_SQL_FUNCTION_ARG
                                text: "'\"federati..:({.*}),\"'"
                                children:
                                  - key: SQL_FUNCTION_ARG_VALUE
                                    type: LITERAL_STRING
                                    text: "'\"federati..:({.*}),\"'"
                              - type: OBJECT_SQL_FUNCTION_ARG
                                text: "1"
                                children:
                                  - key: SQL_FUNCTION_ARG_VALUE
                                    type: LITERAL_INTEGER
                                    text: "1"
                      - key: SQL_RESULT_TARGET_NAME
                        type: NAME
                        text: "inhibitors"
                  - type: OBJECT_SQL_RESULT_TARGET
                    text: "query_plan"
                    children:
                      - key: SQL_RESULT_TARGET_VALUE
                        type: OBJECT_SQL_COLUMN_REF
                        text: "query_plan"
                        children:
                          - key: SQL_COLUMN_REF_PATH
                            type: ARRAY
                            text: "query_plan"
                            children:
                              - type: NAME
                                text: "query_plan"
              - key: SQL_SELECT_FROM
                type: ARRAY
                text: "from icebe..me_queries"
                children:
                  - type: OBJECT_SQL_TABLEREF
                    text: "iceberg.so..me_queries"
                    children:
                      - key: SQL_TABLEREF_NAME
                        type: ARRAY
                        text: "iceberg.so..me_queries"
                        children:
                          - type: NAME
                            text: "iceberg"
                          - type: NAME
                            text: "some_events"
                          - type: NAME
                            text: "some_queries"
              - key: SQL_SELECT_WHERE
                type: OBJECT_SQL_NARY_EXPRESSION
                text: "tenant = '..s_byol > 0"
                children:
                  - key: SQL_EXPRESSION_OPERATOR
                    type: ENUM_SQL_EXPRESSION_OPERATOR
                    value: AND
                  - key: SQL_EXPRESSION_ARGS
                    type: ARRAY
                    text: "tenant = '..s_byol > 0"
                    children:
                      - type: OBJECT_SQL_NARY_EXPRESSION
                        text: "tenant = '../prod/foo'"
                        children:
                          - key: SQL_EXPRESSION_OPERATOR
                            type: ENUM_SQL_EXPRESSION_OPERATOR
                            value: EQUAL
                          - key: SQL_EXPRESSION_ARGS
                            type: ARRAY
                            text: "tenant = '../prod/foo'"
                            children:
                              - type: OBJECT_SQL_COLUMN_REF
                                text: "tenant"
                                children:
                                  - key: SQL_COLUMN_REF_PATH
                                    type: ARRAY
                                    text: "tenant"
                                    children:
                                      - type: NAME
                                        text: "tenant"
                              - type: LITERAL_STRING
                                text: "'a360/prod/foo'"
                      - type: OBJECT_SQL_NARY_EXPRESSION
                        text: "event_time..timestamp)"
                        children:
                          - key: SQL_EXPRESSION_OPERATOR
                            type: ENUM_SQL_EXPRESSION_OPERATOR
                            value: GREATER_THAN
                          - key: SQL_EXPRESSION_ARGS
                            type: ARRAY
                            text: "event_time..timestamp)"
                            children:
                              - type: OBJECT_SQL_COLUMN_REF
                                text: "event_timestamp"
                                children:
                                  - key: SQL_COLUMN_REF_PATH
                                    type: ARRAY
                                    text: "event_timestamp"
                                    children:
                                      - type: NAME
                                        text: "event_timestamp"
                              - type: OBJECT_SQL_FUNCTION_EXPRESSION
                                text: "cast ('202..timestamp)"
                                children:
                                  - key: SQL_FUNCTION_NAME
                                    type: ENUM_SQL_KNOWN_FUNCTION
                                    value: CAST
                                  - key: SQL_FUNCTION_CAST_ARGS
                                    type: OBJECT_SQL_FUNCTION_CAST_ARGS
                                    text: "('2025-04-..timestamp)"
                                    children:
                                      - key: SQL_FUNCTION_CAST_VALUE
                                        type: LITERAL_STRING
                                        text: "'2025-04-14'"
                                      - key: SQL_FUNCTION_CAST_TYPE
                                        type: OBJECT_SQL_TYPENAME
                                        text: "timestamp"
                                        children:
                                          - key: SQL_TYPENAME_TYPE
                                            type: OBJECT_SQL_TIMESTAMP_TYPE
                                            text: "timestamp"
                                            children: []
                      - type: OBJECT_SQL_NARY_EXPRESSION
                        text: "processed_..s_byol > 0"
                        children:
                          - key: SQL_EXPRESSION_OPERATOR
                            type: ENUM_SQL_EXPRESSION_OPERATOR
                            value: GREATER_THAN
                          - key: SQL_EXPRESSION_ARGS
                            type: ARRAY
                            text: "processed_..s_byol > 0"
                            children:
                              - type: OBJECT_SQL_COLUMN_REF
                                text: "processed_rows_byol"
                                children:
                                  - key: SQL_COLUMN_REF_PATH
                                    type: ARRAY
                                    text: "processed_rows_byol"
                                    children:
                                      - type: NAME
                                        text: "processed_rows_byol"
                              - type: LITERAL_INTEGER
                                text: "0"
              - key: SQL_SELECT_ORDER
                type: ARRAY
                text: "order by 3 desc"
                children:
                  - type: OBJECT_SQL_ORDER
                    text: "3 desc"
                    children:
                      - key: SQL_ORDER_VALUE
                        type: LITERAL_INTEGER
                        text: "3"
                      - key: SQL_ORDER_DIRECTION
                        type: ENUM_SQL_ORDER_DIRECTION
                        value: DESCENDING
      scanner-errors: []
      parser-errors: []
      line-breaks:
        - text: [7,8]
        - text: [71,72]
        - text: [181,182]
        - text: [194,195]
        - text: [232,233]
        - text: [263,264]
        - text: [318,319]
        - text: [346,347]
      comments: []
