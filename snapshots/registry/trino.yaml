registry-snapshots:

  - name: trino_explain
    catalog:
      script:
        input: |-
          create table iceberg.some_events.some_queries (
              query_hash varchar,
              query_metrics varchar,
              tenant varchar,
              event_timestamp timestamp
          );
        catalog-id: 1
        tables:
          - catalog-id: "256.65536.4294967296"
            name: some_queries
            text: "create tab..imestamp\n)"
            columns:
              - catalog-id: "256.65536.4294967296.0"
                name: event_timestamp
                text: "event_time.. timestamp"
              - catalog-id: "256.65536.4294967296.1"
                name: query_hash
                text: "query_hash varchar"
              - catalog-id: "256.65536.4294967296.2"
                name: query_metrics
                text: "query_metr..cs varchar"
              - catalog-id: "256.65536.4294967296.3"
                name: tenant
                text: "tenant varchar"
        errors: []
    registry:
      - script:
          input: |-
            select
              *,
              regexp_extract(query_hash, '[0-9a-zA-Z]+\.([0-9a-zA-Z]+)\.[0-9a-zA-Z]+', 1) as query_hash_1,
              regexp_extract(query_hash, '[0-9a-zA-Z]+\.[0-9a-zA-Z]+\.([0-9a-zA-Z]+)', 1) as literals_hash,
              (query like 'EXPLAIN (SQL internal_spark,%') as is_explain,
              (query like '%select distinct count(*)%') as is_count_star
            from iceberg.some_events.some_queries
            where (tenant = 'a360/prod3/foo' or tenant = 'a360/prod/bar')
            and query_metrics like '%raw_sql%'
            and event_timestamp >= current_timestamp - interval '30' day
          catalog-id: 2
          errors: []
          table-refs:
            - type: name/catalog
              catalog-id: "256.65536.4294967296"
              statement-id: 0
              text: "iceberg.so..me_queries"
          expressions:
            - expression-idx: 0
              type: colref/catalog
              catalog: "256.65536.4294967296.1"
              statement-id: 0
              text: "query_hash"
            - expression-idx: 1
              type: colref/catalog
              catalog: "256.65536.4294967296.1"
              statement-id: 0
              text: "query_hash"
            - expression-idx: 2
              type: colref/unresolved
              statement-id: 0
              text: "query"
            - expression-idx: 3
              type: colref/unresolved
              statement-id: 0
              text: "query"
            - expression-idx: 4
              type: colref/catalog
              catalog: "256.65536.4294967296.3"
              statement-id: 0
              text: "tenant"
            - expression-idx: 5
              type: colref/catalog
              catalog: "256.65536.4294967296.3"
              statement-id: 0
              text: "tenant"
            - expression-idx: 6
              type: colref/catalog
              catalog: "256.65536.4294967296.2"
              statement-id: 0
              text: "query_metrics"
            - expression-idx: 7
              type: colref/catalog
              catalog: "256.65536.4294967296.0"
              statement-id: 0
              text: "event_timestamp"
            - expression-idx: 8
              type: function
              name: regexp_extract
              computation: 0
              statement-id: 0
              text: "regexp_ext..A-Z]+', 1)"
            - expression-idx: 9
              type: function
              name: regexp_extract
              computation: 1
              statement-id: 0
              text: "regexp_ext..-Z]+)', 1)"
            - expression-idx: 10
              type: function
              known-function: CURRENT_TIMESTAMP
              is-const: true
              statement-id: 0
              text: "current_timestamp"
            - expression-idx: 11
              type: literal/string
              is-const: true
              statement-id: 0
              text: "'[0-9a-zA-..9a-zA-Z]+'"
            - expression-idx: 12
              type: literal/integer
              is-const: true
              statement-id: 0
              text: "1"
            - expression-idx: 13
              type: literal/string
              is-const: true
              statement-id: 0
              text: "'[0-9a-zA-..a-zA-Z]+)'"
            - expression-idx: 14
              type: literal/integer
              is-const: true
              statement-id: 0
              text: "1"
            - expression-idx: 15
              type: literal/string
              is-const: true
              statement-id: 0
              text: "'EXPLAIN (..l_spark,%'"
            - expression-idx: 16
              type: literal/string
              is-const: true
              statement-id: 0
              text: "'%select d..count(*)%'"
            - expression-idx: 17
              type: literal/string
              is-const: true
              statement-id: 0
              text: "'a360/prod3/foo'"
            - expression-idx: 18
              type: literal/string
              is-const: true
              statement-id: 0
              text: "'a360/prod/bar'"
            - expression-idx: 19
              type: literal/string
              is-const: true
              statement-id: 0
              text: "'%raw_sql%'"
            - expression-idx: 20
              type: literal/string
              is-const: true
              statement-id: 0
              text: "'30'"
            - expression-idx: 21
              type: constcast/interval
              is-const: true
              statement-id: 0
              text: "interval '30' day"
            - expression-idx: 22
              type: binary
              op: MINUS
              arg-left: 10
              arg-right: 21
              is-const: true
              statement-id: 0
              text: "current_ti..l '30' day"
            - expression-idx: 23
              type: comparison
              op: EQUAL
              arg-left: 4
              arg-right: 17
              restriction-target: 4
              statement-id: 0
              text: "tenant = '..prod3/foo'"
            - expression-idx: 24
              type: comparison
              op: EQUAL
              arg-left: 5
              arg-right: 18
              restriction-target: 5
              statement-id: 0
              text: "tenant = '../prod/bar'"
            - expression-idx: 25
              type: comparison
              op: GREATER_EQUAL
              arg-left: 7
              arg-right: 22
              restriction-target: 7
              statement-id: 0
              text: "event_time..l '30' day"
          constants:
            - expression: 11
              text: "'[0-9a-zA-..9a-zA-Z]+'"
            - expression: 12
              text: "1"
            - expression: 13
              text: "'[0-9a-zA-..a-zA-Z]+)'"
            - expression: 14
              text: "1"
            - expression: 15
              text: "'EXPLAIN (..l_spark,%'"
            - expression: 16
              text: "'%select d..count(*)%'"
            - expression: 17
              text: "'a360/prod3/foo'"
            - expression: 18
              text: "'a360/prod/bar'"
            - expression: 19
              text: "'%raw_sql%'"
            - expression: 21
              text: "interval '30' day"
              snippet:
                signature-template: 716161563929057878
                signature-raw: 18138650483241059678
                text: interval '30' day
                ast:
                  ast-nodes: 4
                  ast-bytes: 96
                  ast:
                    type: OBJECT_SQL_CONST_INTERVAL_CAST
                    text: "interval '30' day"
                    children:
                      - key: SQL_CONST_CAST_VALUE
                        type: LITERAL_STRING
                        text: "'30'"
                      - key: SQL_CONST_CAST_INTERVAL
                        type: OBJECT_SQL_INTERVAL_TYPE
                        text: "day"
                        children:
                          - key: SQL_INTERVAL_TYPE
                            type: ENUM_SQL_INTERVAL_TYPE
                            value: DAY
            - expression: 22
              text: "current_ti..l '30' day"
              snippet:
                signature-template: 14335000208411224916
                signature-raw: 14531844735497943305
                text: current_timestamp - interval '30' day
                ast:
                  ast-nodes: 9
                  ast-bytes: 216
                  ast:
                    type: OBJECT_SQL_NARY_EXPRESSION
                    text: "current_ti..l '30' day"
                    children:
                      - key: SQL_EXPRESSION_OPERATOR
                        type: ENUM_SQL_EXPRESSION_OPERATOR
                        value: MINUS
                      - key: SQL_EXPRESSION_ARGS
                        type: ARRAY
                        text: "current_ti..l '30' day"
                        children:
                          - type: OBJECT_SQL_FUNCTION_EXPRESSION
                            text: "current_timestamp"
                            children:
                              - key: SQL_FUNCTION_NAME
                                type: ENUM_SQL_KNOWN_FUNCTION
                                value: CURRENT_TIMESTAMP
                          - type: OBJECT_SQL_CONST_INTERVAL_CAST
                            text: "interval '30' day"
                            children:
                              - key: SQL_CONST_CAST_VALUE
                                type: LITERAL_STRING
                                text: "'30'"
                              - key: SQL_CONST_CAST_INTERVAL
                                type: OBJECT_SQL_INTERVAL_TYPE
                                text: "day"
                                children:
                                  - key: SQL_INTERVAL_TYPE
                                    type: ENUM_SQL_INTERVAL_TYPE
                                    value: DAY
          column-computations:
            - expression: 8
              snippet:
                signature-template: 5606800037095841550
                signature-raw: 3197809837303275225
                text: 'regexp_extract(query_hash, ''[0-9a-zA-Z]+\.([0-9a-zA-Z]+)\.[0-9a-zA-Z]+'', 1)'
                ast:
                  ast-nodes: 12
                  ast-bytes: 288
                  ast:
                    type: OBJECT_SQL_FUNCTION_EXPRESSION
                    text: "regexp_ext..A-Z]+', 1)"
                    children:
                      - key: SQL_FUNCTION_NAME
                        type: ARRAY
                        text: "regexp_extract"
                        children:
                          - type: NAME
                            text: "regexp_extract"
                      - key: SQL_FUNCTION_ARGUMENTS
                        type: ARRAY
                        text: "query_hash..zA-Z]+', 1"
                        children:
                          - type: OBJECT_SQL_FUNCTION_ARG
                            text: "query_hash"
                            children:
                              - key: SQL_FUNCTION_ARG_VALUE
                                type: OBJECT_SQL_COLUMN_REF
                                text: "query_hash"
                                children:
                                  - key: SQL_COLUMN_REF_PATH
                                    type: ARRAY
                                    text: "query_hash"
                                    children:
                                      - type: NAME
                                        text: "query_hash"
                          - type: OBJECT_SQL_FUNCTION_ARG
                            text: "'[0-9a-zA-..9a-zA-Z]+'"
                            children:
                              - key: SQL_FUNCTION_ARG_VALUE
                                type: LITERAL_STRING
                                text: "'[0-9a-zA-..9a-zA-Z]+'"
                          - type: OBJECT_SQL_FUNCTION_ARG
                            text: "1"
                            children:
                              - key: SQL_FUNCTION_ARG_VALUE
                                type: LITERAL_INTEGER
                                text: "1"
            - expression: 9
              snippet:
                signature-template: 5606800037095841550
                signature-raw: 10739155601962827482
                text: 'regexp_extract(query_hash, ''[0-9a-zA-Z]+\.[0-9a-zA-Z]+\.([0-9a-zA-Z]+)'', 1)'
                ast:
                  ast-nodes: 12
                  ast-bytes: 288
                  ast:
                    type: OBJECT_SQL_FUNCTION_EXPRESSION
                    text: "regexp_ext..-Z]+)', 1)"
                    children:
                      - key: SQL_FUNCTION_NAME
                        type: ARRAY
                        text: "regexp_extract"
                        children:
                          - type: NAME
                            text: "regexp_extract"
                      - key: SQL_FUNCTION_ARGUMENTS
                        type: ARRAY
                        text: "query_hash..A-Z]+)', 1"
                        children:
                          - type: OBJECT_SQL_FUNCTION_ARG
                            text: "query_hash"
                            children:
                              - key: SQL_FUNCTION_ARG_VALUE
                                type: OBJECT_SQL_COLUMN_REF
                                text: "query_hash"
                                children:
                                  - key: SQL_COLUMN_REF_PATH
                                    type: ARRAY
                                    text: "query_hash"
                                    children:
                                      - type: NAME
                                        text: "query_hash"
                          - type: OBJECT_SQL_FUNCTION_ARG
                            text: "'[0-9a-zA-..a-zA-Z]+)'"
                            children:
                              - key: SQL_FUNCTION_ARG_VALUE
                                type: LITERAL_STRING
                                text: "'[0-9a-zA-..a-zA-Z]+)'"
                          - type: OBJECT_SQL_FUNCTION_ARG
                            text: "1"
                            children:
                              - key: SQL_FUNCTION_ARG_VALUE
                                type: LITERAL_INTEGER
                                text: "1"
          column-filters:
            - expression: 23
              snippet:
                signature-template: 7878761948638532652
                signature-raw: 12915170941615982935
                text: tenant = 'a360/prod3/foo'
                ast:
                  ast-nodes: 7
                  ast-bytes: 168
                  ast:
                    type: OBJECT_SQL_NARY_EXPRESSION
                    text: "tenant = '..prod3/foo'"
                    children:
                      - key: SQL_EXPRESSION_OPERATOR
                        type: ENUM_SQL_EXPRESSION_OPERATOR
                        value: EQUAL
                      - key: SQL_EXPRESSION_ARGS
                        type: ARRAY
                        text: "tenant = '..prod3/foo'"
                        children:
                          - type: OBJECT_SQL_COLUMN_REF
                            text: "tenant"
                            children:
                              - key: SQL_COLUMN_REF_PATH
                                type: ARRAY
                                text: "tenant"
                                children:
                                  - type: NAME
                                    text: "tenant"
                          - type: LITERAL_STRING
                            text: "'a360/prod3/foo'"
            - expression: 24
              snippet:
                signature-template: 7878761948638532652
                signature-raw: 13423462593048553321
                text: tenant = 'a360/prod/bar'
                ast:
                  ast-nodes: 7
                  ast-bytes: 168
                  ast:
                    type: OBJECT_SQL_NARY_EXPRESSION
                    text: "tenant = '../prod/bar'"
                    children:
                      - key: SQL_EXPRESSION_OPERATOR
                        type: ENUM_SQL_EXPRESSION_OPERATOR
                        value: EQUAL
                      - key: SQL_EXPRESSION_ARGS
                        type: ARRAY
                        text: "tenant = '../prod/bar'"
                        children:
                          - type: OBJECT_SQL_COLUMN_REF
                            text: "tenant"
                            children:
                              - key: SQL_COLUMN_REF_PATH
                                type: ARRAY
                                text: "tenant"
                                children:
                                  - type: NAME
                                    text: "tenant"
                          - type: LITERAL_STRING
                            text: "'a360/prod/bar'"
            - expression: 25
              snippet:
                signature-template: 17608407916322461543
                signature-raw: 17046291626474264120
                text: event_timestamp >= current_timestamp - interval '30' day
                ast:
                  ast-nodes: 15
                  ast-bytes: 360
                  ast:
                    type: OBJECT_SQL_NARY_EXPRESSION
                    text: "event_time..l '30' day"
                    children:
                      - key: SQL_EXPRESSION_OPERATOR
                        type: ENUM_SQL_EXPRESSION_OPERATOR
                        value: GREATER_EQUAL
                      - key: SQL_EXPRESSION_ARGS
                        type: ARRAY
                        text: "event_time..l '30' day"
                        children:
                          - type: OBJECT_SQL_COLUMN_REF
                            text: "event_timestamp"
                            children:
                              - key: SQL_COLUMN_REF_PATH
                                type: ARRAY
                                text: "event_timestamp"
                                children:
                                  - type: NAME
                                    text: "event_timestamp"
                          - type: OBJECT_SQL_NARY_EXPRESSION
                            text: "current_ti..l '30' day"
                            children:
                              - key: SQL_EXPRESSION_OPERATOR
                                type: ENUM_SQL_EXPRESSION_OPERATOR
                                value: MINUS
                              - key: SQL_EXPRESSION_ARGS
                                type: ARRAY
                                text: "current_ti..l '30' day"
                                children:
                                  - type: OBJECT_SQL_FUNCTION_EXPRESSION
                                    text: "current_timestamp"
                                    children:
                                      - key: SQL_FUNCTION_NAME
                                        type: ENUM_SQL_KNOWN_FUNCTION
                                        value: CURRENT_TIMESTAMP
                                  - type: OBJECT_SQL_CONST_INTERVAL_CAST
                                    text: "interval '30' day"
                                    children:
                                      - key: SQL_CONST_CAST_VALUE
                                        type: LITERAL_STRING
                                        text: "'30'"
                                      - key: SQL_CONST_CAST_INTERVAL
                                        type: OBJECT_SQL_INTERVAL_TYPE
                                        text: "day"
                                        children:
                                          - key: SQL_INTERVAL_TYPE
                                            type: ENUM_SQL_INTERVAL_TYPE
                                            value: DAY

  - name: trino_inhibitors
    catalog:
      script:
        input: |-
          create table iceberg.some_events.some_queries (
              query_hash varchar,
              query_metrics varchar,
              tenant varchar,
              event_timestamp timestamp
          );
        catalog-id: 1
        tables:
          - catalog-id: "256.65536.4294967296"
            name: some_queries
            text: "create tab..imestamp\n)"
            columns:
              - catalog-id: "256.65536.4294967296.0"
                name: event_timestamp
                text: "event_time.. timestamp"
              - catalog-id: "256.65536.4294967296.1"
                name: query_hash
                text: "query_hash varchar"
              - catalog-id: "256.65536.4294967296.2"
                name: query_metrics
                text: "query_metr..cs varchar"
              - catalog-id: "256.65536.4294967296.3"
                name: tenant
                text: "tenant varchar"
        errors: []
    registry:
      - script:
          catalog-id: 2
          errors: []
